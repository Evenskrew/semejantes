<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Gestión de Usuarios</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f5f5f5;
      }
      section {
        background: white;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      h2 {
        margin-top: 0;
      }
      input,
      button,
      textarea {
        margin: 5px 0;
        padding: 8px;
        width: 100%;
        box-sizing: border-box;
      }
      textarea {
        height: 180px;
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <h1>Gestión de Usuarios</h1>

    <!-- OBTENER TODOS LOS USUARIOS -->
    <section>
      <h2>Obtener Todos los Usuarios</h2>
      <button onclick="getUsers()">Ver Usuarios</button>
      <textarea id="usersBox" readonly></textarea>
    </section>

    <!-- OBTENER USUARIO POR ID -->
    <section>
      <h2>Obtener Usuario por ID</h2>
      <input id="gu-id" placeholder="ID del Usuario" />
      <button onclick="getUser()">Buscar</button>
    </section>

    <!-- OBTENER USUARIOS POR DÍA -->
    <section>
      <h2>Obtener Usuarios por Día de Disponibilidad</h2>
      <input id="gu-day" placeholder="Ej: Lunes, Martes, etc." />
      <button onclick="getUsersByDay()">Buscar</button>
    </section>

    <!-- ACTUALIZAR USUARIO -->
    <section>
      <h2>Actualizar Usuario</h2>
      <input id="uu-id" placeholder="ID del Usuario" />
      <textarea
        id="uu-body"
        placeholder='JSON con campos a actualizar {"username":"nuevo","phone":"123"}'
      ></textarea>
      <button onclick="updateUser()">Actualizar</button>
    </section>

    <!-- ELIMINAR USUARIO -->
    <section>
      <h2>Eliminar Usuario</h2>
      <input id="du-id" placeholder="ID del Usuario" />
      <button onclick="deleteUser()">Eliminar</button>
    </section>

    <!-- RESPUESTA -->
    <section>
      <h2>Respuesta del Servidor</h2>
      <textarea id="responseBox" readonly></textarea>
    </section>

    <script>
      const API_URL = "/api/users"; // ajusta según tu backend
      const token = localStorage.getItem("token") || "";

      function showResponse(data) {
        document.getElementById("responseBox").value = JSON.stringify(
          data,
          null,
          2
        );
      }

      // GET ALL
      async function getUsers() {
        const res = await fetch(`${API_URL}`, {
          headers: { Authorization: `Bearer ${token}` },
        });
        const data = await res.json();
        document.getElementById("usersBox").value = JSON.stringify(
          data,
          null,
          2
        );
        showResponse(data);
      }

      // GET BY ID
      async function getUser() {
        const id = document.getElementById("gu-id").value;
        const res = await fetch(`${API_URL}/${id}`, {
          headers: { Authorization: `Bearer ${token}` },
        });
        const data = await res.json();
        showResponse(data);
      }

      // GET BY DAY
      async function getUsersByDay() {
        const day = document.getElementById("gu-day").value;
        const res = await fetch(`${API_URL}/day/${day}`, {
          headers: { Authorization: `Bearer ${token}` },
        });
        const data = await res.json();
        showResponse(data);
      }

      // UPDATE
      async function updateUser() {
        const id = document.getElementById("uu-id").value;
        let body;
        try {
          body = JSON.parse(document.getElementById("uu-body").value);
        } catch (err) {
          return alert("JSON inválido en el cuerpo de actualización");
        }

        const res = await fetch(`${API_URL}/${id}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`,
          },
          body: JSON.stringify(body),
        });

        const data = await res.json();
        showResponse(data);
      }

      // DELETE
      async function deleteUser() {
        const id = document.getElementById("du-id").value;
        const res = await fetch(`${API_URL}/${id}`, {
          method: "DELETE",
          headers: { Authorization: `Bearer ${token}` },
        });
        const data = await res.json();
        showResponse(data);
      }
    </script>
  </body>
</html>