<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Eventos</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f5f5f5;
      }
      section {
        background: white;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      h2 {
        margin-top: 0;
      }
      input,
      button {
        margin: 5px 0;
        padding: 8px;
        width: 100%;
        box-sizing: border-box;
      }
      textarea {
        width: 100%;
        height: 200px;
        margin-top: 10px;
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <h1>Gestión de Eventos</h1>

    <!-- CREAR EVENTO -->
    <section>
      <h2>Crear Evento (Coordinador)</h2>
      <input id="ev-description" placeholder="Descripción" />
      <input id="ev-date" type="date" />
      <input id="ev-hour" type="time" />
      <button onclick="createEvent()">Crear</button>
    </section>

    <!-- LISTAR EVENTOS -->
    <section>
      <h2>Listar Eventos</h2>
      <button onclick="getEvents()">Obtener Eventos</button>
      <textarea id="eventsBox" readonly></textarea>
    </section>

    <!-- PARTICIPAR EN EVENTO -->
    <section>
      <h2>Participar en Evento (Voluntario)</h2>
      <input id="pe-id" placeholder="ID del Evento" />
      <button onclick="participateEvent()">Participar</button>
    </section>

    <!-- ACTUALIZAR EVENTO -->
    <section>
      <h2>Actualizar Evento (Coordinador)</h2>
      <input id="ue-id" placeholder="ID del Evento" />
      <input id="ue-description" placeholder="Nueva descripción (opcional)" />
      <input id="ue-date" type="date" />
      <input id="ue-hour" type="time" />
      <button onclick="updateEvent()">Actualizar</button>
    </section>

    <!-- ELIMINAR EVENTO -->
    <section>
      <h2>Eliminar Evento (Coordinador)</h2>
      <input id="de-id" placeholder="ID del Evento" />
      <button onclick="deleteEvent()">Eliminar</button>
    </section>

    <!-- RESPUESTA -->
    <section>
      <h2>Respuesta del Servidor</h2>
      <textarea id="responseBox" readonly></textarea>
    </section>

    <script>
      const API_URL = "/api/events"; // cambia según tu ruta backend
      const token = localStorage.getItem("token") || "";
      if (!token) {
        alert("No estás logueado. Redirigiendo a login...");
        window.location.href = "/auth.html";
        }

      function showResponse(data) {
        document.getElementById("responseBox").value = JSON.stringify(
          data,
          null,
          2
        );
      }

      // CREATE
      async function createEvent() {
        const body = {
          description: document.getElementById("ev-description").value,
          date: document.getElementById("ev-date").value,
          hour: document.getElementById("ev-hour").value,
        };

        const res = await fetch(`${API_URL}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: token,
          },
          body: JSON.stringify(body),
        });

        const data = await res.json();
        showResponse(data);
      }

      // READ (GET)
      async function getEvents() {
        const res = await fetch(`${API_URL}`, {
          headers: { Authorization: token },
        });
        const data = await res.json();
        document.getElementById("eventsBox").value = JSON.stringify(
          data,
          null,
          2
        );
        showResponse(data);
      }

      // PARTICIPATE
      async function participateEvent() {
        const id = document.getElementById("pe-id").value;
        const res = await fetch(`${API_URL}/${id}/participate`, {
          method: "PATCH",
          headers: {
            "Content-Type": "application/json",
            Authorization: token,
          },
        });

        const data = await res.json();
        showResponse(data);
      }

      // UPDATE
      async function updateEvent() {
        const id = document.getElementById("ue-id").value;
        const body = {
          description: document.getElementById("ue-description").value,
          date: document.getElementById("ue-date").value,
          hour: document.getElementById("ue-hour").value,
        };

        const res = await fetch(`${API_URL}/${id}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            Authorization: token,
          },
          body: JSON.stringify(body),
        });

        const data = await res.json();
        showResponse(data);
      }

      // DELETE
      async function deleteEvent() {
        const id = document.getElementById("de-id").value;
        const res = await fetch(`${API_URL}/${id}`, {
          method: "DELETE",
          headers: { Authorization: token },
        });

        const data = await res.json();
        showResponse(data);
      }
    </script>
  </body>
</html>